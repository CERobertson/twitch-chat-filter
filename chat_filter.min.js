(function(e){"use strict";var t=document.createElement("script");t.appendChild(document.createTextNode("("+e.toString()+"());"));document.body.appendChild(t)})(function(){"use strict";function n(e,t){for(var n=0;n<e.length;n++){t(e[n],n,e)}}function r(e,t){for(var n=0;n<e.length;n++){if(t(e[n]))return true}return false}function i(e,t){for(var n=0;n<e.length;n++){if(!t(e[n]))return false}return true}function s(e,t){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n)){t(n,e[n])}}}function o(e,t){e=e.toLowerCase();return e.indexOf(t.toLowerCase())>=0}function a(e){u.push(e)}function f(){n(u,function(e){e()})}function h(e){n(l,function(t){if(!(t in e)){throw new Error("Missing param "+t)}});s(e,function(e){if(l.indexOf(e)<0&&c.indexOf(e)<0){throw new Error("Unexpected param "+e)}});var t=this;s(e,function(e,n){t[e]=n});this._value=null;this._observers=[]}function y(e){var t=new h(e);p.push(t);d[t.name]=t;if(t.message_filter){v.push(t)}if(t.message_css){g.push(t)}if(t.message_rewriter){m.push(t)}}function b(e){return d[e].getValue()}function x(e){var t=localStorage.getItem(e);return t?JSON.parse(t):null}function T(e,t){localStorage.setItem(e,JSON.stringify(t))}function N(){var e={};var t=x(E);if(t){s(d,function(r){n(["filters","rewriters","stylers"],function(n){if(t[n].indexOf(r)>=0){e[r]=true}})})}var r=x(S);if(r){e["TppBanCustomWords"]=true;e["TppBannedWords"]=r}return e}function C(){var e;if(window.localStorage){e=x(w)||N()}else{e={}}s(d,function(t,n){if(t in e){n.setValue(e[t])}else{n.setValue(null)}})}function k(){if(!window.localStorage)return;var e={};s(d,function(t,n){if(n._value!==null){e[t]=n._value}});T(w,e);localStorage.removeItem(E);localStorage.removeItem(S)}function P(e){$("head").append("<style>"+e.join("")+"</style>")}function j(e,t){if(e.length===0)return t.length;if(t.length===0)return e.length;var n=[];var r,i;for(r=0;r<=t.length;r++){n[r]=[r]}for(i=0;i<=e.length;i++){n[0][i]=i}for(r=1;r<=t.length;r++){for(i=1;i<=e.length;i++){if(t.charAt(r-1)===e.charAt(i-1)){n[r][i]=n[r-1][i-1]}else{n[r][i]=1+Math.min(n[r-1][i-1],n[r][i-1],n[r-1][i])}}}return n[t.length][e.length]}function F(e){return r(H,function(t){return j(t.toLowerCase(),e.toLowerCase())<=B})}function I(e){if(/^([0-9]+),([0-9]+)$/.test(e.replace(/\s/g,""))){return true}return i(e.split(/\s+/),function(e){if(e.length<=0){return true}var t=e.match(/(?:([a-z]+)[^a-z]{0,2})+/ig);return t&&i(t,function(e){var t=e.match(/[a-z]+/ig);return i(t,F)})})}function R(e){var t=0;n(q,function(n){if(o(e,n)){t++}});return t>=2}function U(e){var t=0;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(9600<=r&&r<=9632){t++}}return t>3}function z(e){return/[\u0400-\u04FF]/.test(e)}function X(e){var t=0;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(W.indexOf(r)>=0){t++}}return t>1}function V(e){return e.split(/\s/g).length<=1}function J(e){return e.length>=200}function K(e){return/^\s*\!/.test(e)}function G(e,t){if(t.toLowerCase()==="tppbankbot"){if(Q){return e.toLowerCase().indexOf("@"+Q.toLowerCase())<0}else{return true}}return false}function Y(e){return e.replace(/(.{4}.*?)(\s*?\1)+/g,"$1")}function Z(e){return e.replace(/[\u0300-\u036F]/g,"")}function tt(e){var t=e;n(et,function(e){t=t.replace(e,"")});return/^\s*$/.test(t)}function nt(e){var t=b("TppBanCustomWords");var n=b("TppBannedWords");return t&&r(n,function(t){return o(e,t)})}function it(e,t){return i(v,function(n){return!(n.getValue()&&n.message_filter(e,t))})}function st(e,t){var r=e;n(m,function(e){if(e.getValue()){r=e.message_rewriter(r,t)||r}});return r}function pt(e){var t=Date.now();ft=t;ct=lt;lt={text:e,time:t}}function dt(){lt=ct;ct=null}function vt(e){var t;if(/now in slow mode/.test(e)){t=/(\d+) second/.exec(e);if(t){if(ut==Number(t[1]))return false;ut=Number(t[1])}}if(/identical to the previous/.test(e)){t=/than (\d+) second/.exec(e);if(t){at=Number(t[1])}dt()}if(/you are sending messages too quickly/.test(e)){t=/in (\d+) second/.exec(e);if(t){var n=Number(t[1]);var r=Date.now()-lt.time+1e3*n;ut=Math.ceil(r/1e3)}dt()}if(/You are banned/.test(e)){t=/for (\d+) more second/.exec(e);if(t){var i=Number(t[1]);ht=Date.now()+1e3*i}dt()}Et();return true}function mt(e){var t=Date.now();if(ht){var n=ht-t;if(n>0){return{blocked:true,error:"you are banned",wait:n}}}if(lt){var r=ft+ot-t;if(r>0){return{blocked:true,error:"",wait:null}}if(e===lt.text){var i=lt.time+1e3*at-t;if(i>0){return{blocked:true,error:"repeated message",wait:i}}}var s=lt.time+1e3*ut-t;if(s>0){return{blocked:true,error:"slowmode",wait:s}}}return{blocked:false}}function Et(){var e=$(_).val();var t=mt(e);var n=$(D);if(b("TppSlowmodeHelper")&&t.blocked){var r;if(t.error){r="Wait "+Math.ceil(t.wait/1e3)+" seconds ("+t.error+")"}else{r="..."}n.addClass(yt);n.text(r);wt=false}else{if(!wt){n.removeClass(yt);n.text(bt);wt=true}}}var e="2.8";var t="TPP Chat Filter version "+e+" loaded. Please report bugs and suggestions to https://github.com/jpgohlke/twitch-chat-filter";var u=[];var l=["name","comment","category","defaultValue"];var c=["longComment","message_filter","message_css","message_rewriter"];h.prototype.getValue=function(){if(this._value!==null){return this._value}else{return this.defaultValue}};h.prototype.setValue=function(e){var t=this.getValue();this._value=e;var r=this.getValue();n(this._observers,function(e){e(r,t)})};h.prototype.reset=function(){this.setValue(null)};h.prototype.observe=function(e){this._observers.push(e)};h.prototype.forceObserverUpdate=function(){var e=this.getValue();n(this._observers,function(t){t(e,e)})};var p=[];var d={};var v=[];var m=[];var g=[];var w="tpp-chat-filter-settings";var E="tpp-custom-filter-active";var S="tpp-custom-filter-phrases";a(function(){n(p,function(e){e.observe(function(){k()})})});var L=".chat-room";var A=".message";var O=".from";var M=".chat-line";var _=".chat-interface textarea";var D=".send-chat-button button";var H=["left","right","up","down","start","select","a","b","l","r","democracy","anarchy","wait"];var B=2;y({name:"TppFilterCommand",comment:"Emulator commands",longComment:H.join(", "),category:"filters_category",defaultValue:true,message_filter:I});var q=["misty","whitney","milk","guys","we have to","we need to","beat"];y({name:"TppFilterMisty",comment:"Misty meme",longComment:"Guys we need to milk Witney",category:"filters_category",defaultValue:true,message_filter:R});y({name:"TppFilterAscii",comment:"Blocky drawings",longComment:"Stuff like this: ¦¦¦¦¦¦¦¦¦ ¯¦¯¦_¦",category:"filters_category",defaultValue:true,message_filter:U});y({name:"TppFilterCyrillic",comment:"Cyrillic",longComment:"Cyrillic characters in copypastas confuse our other filters",category:"filters_category",defaultValue:true,message_filter:z});var W=[3720,9685,664,8362,3232,176,8248,8226,7886,3237];y({name:"TppFilterDonger",comment:"Dongers",longComment:"????????",category:"filters_category",defaultValue:false,message_filter:X});y({name:"TppFilterSmall",comment:"One-word messages",category:"filters_category",defaultValue:false,message_filter:V});y({name:"TppFilterLong",comment:"Overly long messages",longComment:"Hide messages over 200 characters (around 4 lines)",category:"filters_category",defaultValue:false,message_filter:J});y({name:"TppFilterBets",comment:"Stadium bets",longComment:'Any message starting with a "!". ex.: "!bet 100 blue"',category:"filters_category",defaultValue:true,message_filter:K});var Q=null;a(function(){if(Twitch){Q=Twitch.user.displayName()}});y({name:"TppFilterBankBot",comment:"Stadium bank bot",longComment:"Messages from the bank bot about other players' balances",category:"filters_category",defaultValue:true,message_filter:G});y({name:"TppRewriteDuplicates",comment:"Copy pasted repetitions",category:"rewriters_category",defaultValue:true,message_rewriter:Y});y({name:"TppMopUpDrinks",comment:"Mop up spilled drinks",category:"rewriters_category",defaultValue:true,message_rewriter:Z});y({name:"TppConvertAllcaps",comment:"Lowercase everything",longComment:null,category:"visual_category",defaultValue:true,message_css:A+"{text-transform:lowercase !important;}"});var et=[];a(function(){if(Twitch){Twitch.api.get("chat/emoticons").then(function(e){n(e.emoticons,function(e){var t=e.regex;if(t.match(/^\w+$/)){t="\\b"+t+"\\b"}et.push(new RegExp(t,"g"))})})}});y({name:"TppHideEmoticons",comment:"Hide emoticons",category:"visual_category",defaultValue:false,message_css:A+" .emoticon{display:none !important;}",message_filter:tt});y({name:"TppNoColor",comment:"Uncolor messages",longComment:"Remove color from messages created with the /me command",category:"visual_category",defaultValue:false,message_css:A+" {color:inherit !important;}"});y({name:"TppBanCustomWords",comment:"Activate custom banlist",longComment:"",category:"customs_category",defaultValue:false,message_css:"#menu-TppBannedWords { display:inherit; }"});a(function(){P(["#menu-TppBannedWords { display:none; }"])});y({name:"TppBannedWords",comment:"Banned Phrases",longComment:"If the custom banlist is activated, these messages will be hidden",category:"customs_category",defaultValue:[],message_filter:nt});var rt=".chat-settings";a(function(){function r(){var n=t.height();if(n>0){e.css("max-height",.9*n)}}function i(e,t){e.append($("<label>").attr("for",t.name).attr("title",t.longComment||"").append($('<input type="checkbox">').attr("id",t.name)).append(document.createTextNode(" "+t.comment)));var n=$("#"+t.name);n.on("change",function(){t.setValue($(this).prop("checked"))});t.observe(function(e){n.prop("checked",e)})}function s(e,t){function r(e){var n=t.getValue().slice();if(n.indexOf(e)<0){n.push(e);t.setValue(n)}}function i(e){var n=t.getValue().slice();n.splice(e,1);t.setValue(n)}function s(){$("#show-"+t.name).show();$("#hide-"+t.name).hide();$("#clear-"+t.name).hide();$("#list-"+t.name).hide()}function o(){$("#show-"+t.name).hide();$("#hide-"+t.name).show();$("#clear-"+t.name).show();$("#list-"+t.name).show()}e.append($("<label>").attr("for",t.name).attr("title",t.longComment||"").append(document.createTextNode("Add "+t.comment)).append($('<input type="text">').attr("id",t.name).css("width","100%"))).append($("<button>").attr("id","show-"+t.name).append(document.createTextNode("Show ")).append($("<span>").attr("id","num-banned-"+t.name)).append(document.createTextNode(" "+t.comment))).append($("<button>").attr("id","hide-"+t.name).append(document.createTextNode("Hide "+t.comment))).append($('<div class="custom_list_menu">').attr("id","list-"+t.name)).append($("<button>").attr("id","clear-"+t.name).append(document.createTextNode("Clear "+t.comment)));s();t.observe(function(e){$("#num-banned-"+t.name).text(e.length);var r=$("#list-"+t.name);r.empty();n(e,function(e,t){r.append($("<li>").text(e).append($('<a href="#">').text("[X]").click(function(){i(t)})))})});$("#"+t.name).keyup(function(e){var t=$(this).val().trim();if(e.keyCode===13&&t!==""){r(t);$(this).val("")}});$("#show-"+t.name).click(function(e){e.preventDefault();o()});$("#hide-"+t.name).click(function(e){e.preventDefault();s()});$("#clear-"+t.name).click(function(e){e.preventDefault();t.setValue([])})}function o(t){$('<div class="chat-menu-header"/>').text(t).appendTo(e);var n=$('<div class="chat-menu-content">').appendTo(e);return n}function u(e,t){n(p,function(n){if(n.category!==t)return;var r=$("<p>").attr("id","menu-"+n.name).addClass("dropmenu_action").appendTo(e);var o=typeof n.defaultValue;if(o==="boolean"){i(r,n)}else if(o==="object"){s(r,n)}else{throw new Error("Unrecognized setting "+o)}})}P([".chat-room { z-index: inherit !important; }",".chat-settings { z-index: 100 !important; }",".custom_list_menu li {background: #bbb; display: block; list-style: none; margin: 1px 0; padding: 0 2px}",".custom_list_menu li a {float: right;}"]);var e=$(rt);var t=$(L);e.css("overflow-y","auto");r();setInterval(r,500);$(window).resize(r);var a=o("Hide");u(a,"filters_category");var f=o("Automatically rewrite");u(f,"rewriters_category");var l=o("Visual tweaks");u(l,"visual_category");var c=o("Custom Banlist");u(c,"customs_category");var h=o("Misc");h.append($("<button>Reset TPP filter settings</a>").click(function(){if(confirm("This will reset all Twitch Chat Filter settings to their default values and will delete all custom banned phrases. Are you sure you want to continue?")){n(p,function(e){e.reset()})}}))});a(function(){var e=[];n(g,function(t){e.push(L+"."+t.name+" "+t.message_css)});P(e);n(g,function(e){e.observe(function(t){$(L).toggleClass(e.name,t)})})});a(function(){n(p,function(e){e.observe(function(){$(M).each(function(){var e=$(this);var t=e.find(A).text().trim();var n=e.find(O).text().trim();e.toggle(it(t,n))})})})});var ot=1e3;var ut=2;var at=30;var ft=null;var lt=null;var ct=null;var ht=null;var gt=500;var yt="tpp-slowmode-warning";var bt=null;var wt=true;a(function(){bt=$(D).text();P(["."+yt+"{ opacity:0.7 !important}"]);$(_).keyup(function(e){if(e.keyCode!==13){Et()}});setInterval(function(){Et()},gt)});y({name:"TppSlowmodeHelper",comment:"Slowmode helper",longComment:"Shows a countdown of how long you need to wait until being able to chat again",category:"visual_category",defaultValue:true});a(function(){var e=App.Room.prototype;var t=e.addMessage;e.addMessage=function(e){if(e.style==="admin"){if(!vt(e.message)){return false}}else{e.message=st(e.message,e.from);if(!it(e.message,e.from)){return false}}return t.apply(this,arguments)};var n=e.send;e.send=function(e){pt(e);return n.apply(this,arguments)}});$(function(){f();C();console.log(t)})})